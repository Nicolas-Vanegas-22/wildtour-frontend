import{g as P,e as v,r as p,j as t,m as N,B as y,V as E,W as k,C as T,h as S}from"./index-BxPqZtyK.js";import{u as $}from"./useToast-B6lGbM68.js";const i="http://localhost:5000/api",A="TEST-your-public-key-here",C=!0;class D{constructor(){this.mp=null,this.initializeMercadoPago()}async initializeMercadoPago(){try{typeof window<"u"&&console.log("MercadoPago SDK initialized with key:",A)}catch(r){console.error("Error initializing MercadoPago:",r)}}getAuthHeaders(){const r=localStorage.getItem("authToken");return{"Content-Type":"application/json",Authorization:r?`Bearer ${r}`:""}}async createPreference(r){try{const e=await fetch(`${i}/payments/mercadopago/preference`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(r)});if(!e.ok)throw new Error(`Error: ${e.status}`);const a=await e.json();return a.id?a:{id:`PREF_${Date.now()}`,init_point:`https://www.mercadopago.com.co/checkout/v1/redirect?pref_id=PREF_${Date.now()}`,sandbox_init_point:`https://sandbox.mercadopago.com.co/checkout/v1/redirect?pref_id=PREF_${Date.now()}`}}catch(e){throw console.error("Error creating MercadoPago preference:",e),e}}async processCardPayment(r){try{const e=await fetch(`${i}/payments/mercadopago/process`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(r)});if(!e.ok)throw new Error(`Error: ${e.status}`);return await e.json()}catch(e){throw console.error("Error processing card payment:",e),e}}async getPaymentStatus(r){try{const e=await fetch(`${i}/payments/mercadopago/status/${r}`,{method:"GET",headers:this.getAuthHeaders()});if(!e.ok)throw new Error(`Error: ${e.status}`);return await e.json()}catch(e){throw console.error("Error getting payment status:",e),e}}async createCardToken(r){return new Promise((e,a)=>{if(!this.mp){setTimeout(()=>{e({id:`CARD_TOKEN_${Date.now()}`})},1e3);return}})}async getPaymentMethods(){try{const r=await fetch(`${i}/payments/mercadopago/payment-methods`,{method:"GET",headers:this.getAuthHeaders()});if(!r.ok)throw new Error(`Error: ${r.status}`);const e=await r.json();return!e||e.length===0?[{id:"visa",name:"Visa",payment_type_id:"credit_card",thumbnail:"https://img.icons8.com/color/48/000000/visa.png",secure_thumbnail:"https://img.icons8.com/color/48/000000/visa.png"},{id:"master",name:"Mastercard",payment_type_id:"credit_card",thumbnail:"https://img.icons8.com/color/48/000000/mastercard.png",secure_thumbnail:"https://img.icons8.com/color/48/000000/mastercard.png"},{id:"amex",name:"American Express",payment_type_id:"credit_card",thumbnail:"https://img.icons8.com/color/48/000000/amex.png",secure_thumbnail:"https://img.icons8.com/color/48/000000/amex.png"},{id:"pse",name:"PSE",payment_type_id:"bank_transfer",thumbnail:"https://img.icons8.com/color/48/000000/bank.png",secure_thumbnail:"https://img.icons8.com/color/48/000000/bank.png"}]:e}catch(r){throw console.error("Error getting payment methods:",r),r}}async getInstallments(r,e){try{const a=await fetch(`${i}/payments/mercadopago/installments?payment_method_id=${r}&amount=${e}`,{method:"GET",headers:this.getAuthHeaders()});if(!a.ok)throw new Error(`Error: ${a.status}`);return await a.json()}catch(a){throw console.error("Error getting installments:",a),a}}async createSimplePayment(r,e){try{return await new Promise(n=>setTimeout(n,1e3)),{checkoutUrl:C?`https://sandbox.mercadopago.com.co/checkout/v1/redirect?pref_id=BOOKING_${r}`:`https://www.mercadopago.com.co/checkout/v1/redirect?pref_id=BOOKING_${r}`}}catch(a){throw console.error("Error creating simple payment:",a),a}}async processWebhookNotification(r){try{await fetch(`${i}/payments/mercadopago/webhook`,{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(r)})}catch(e){throw console.error("Error processing webhook notification:",e),e}}}const I=new D;function B(){const[o]=P(),r=v(),{showToast:e}=$(),[a,n]=p.useState("loading"),[s,h]=p.useState(null);p.useEffect(()=>{x()},[]);const x=async()=>{try{const l=o.get("collection_id"),b=o.get("collection_status"),d=o.get("payment_id"),_=o.get("status"),g=o.get("external_reference"),u=o.get("payment_type"),j=o.get("merchant_order_id"),O=o.get("preference_id");if(!l&&!d){n("error");return}switch(b||_){case"approved":n("approved"),h({collection_id:l,payment_id:d,external_reference:g,payment_type:u,merchant_order_id:j}),e("¡Pago aprobado exitosamente!","success");break;case"pending":case"in_process":n("pending"),h({collection_id:l,payment_id:d,external_reference:g,payment_type:u}),e("Pago en proceso de verificación","info");break;case"rejected":case"cancelled":n("rejected"),e("Pago rechazado o cancelado","error");break;default:n("error"),e("Estado de pago desconocido","error")}if(d)try{const m=await I.getPaymentStatus(d);console.log("Payment status from API:",m)}catch(m){console.error("Error getting payment status:",m)}}catch(l){console.error("Error processing payment return:",l),n("error"),e("Error procesando el resultado del pago","error")}},f=()=>{switch(a){case"approved":return{icon:S,color:"text-green-600",bgColor:"bg-green-100",title:"¡Pago aprobado!",message:"Tu pago ha sido procesado exitosamente. Recibirás un email de confirmación.",actionText:"Ver mi reserva",actionPath:"/profile"};case"pending":return{icon:T,color:"text-yellow-600",bgColor:"bg-yellow-100",title:"Pago en proceso",message:"Tu pago está siendo verificado. Te notificaremos cuando se confirme.",actionText:"Ver estado de reserva",actionPath:"/profile"};case"rejected":return{icon:k,color:"text-red-600",bgColor:"bg-red-100",title:"Pago rechazado",message:"Tu pago no pudo ser procesado. Puedes intentar con otro método de pago.",actionText:"Intentar de nuevo",actionPath:"/servicios"};default:return{icon:E,color:"text-gray-600",bgColor:"bg-gray-100",title:"Error procesando pago",message:"Hubo un problema al procesar tu pago. Contacta con soporte.",actionText:"Volver al inicio",actionPath:"/"}}};if(a==="loading")return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-accent-50 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Procesando resultado del pago..."}),t.jsx("p",{className:"text-gray-600",children:"Por favor espera mientras verificamos tu pago"})]})});const c=f(),w=c.icon;return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-accent-50 flex items-center justify-center p-4",children:t.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-white/80 backdrop-blur-lg rounded-3xl shadow-strong border border-white/20 p-8 w-full max-w-md text-center",children:[t.jsx("div",{className:"flex justify-center mb-6",children:t.jsx("div",{className:`w-20 h-20 ${c.bgColor} rounded-full flex items-center justify-center`,children:t.jsx(w,{className:`w-12 h-12 ${c.color}`})})}),t.jsxs("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:c.title}),t.jsx("p",{className:"text-gray-600 leading-relaxed",children:c.message})]}),s&&t.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 text-left",children:[t.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Detalles del pago"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[s.payment_id&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"ID del pago:"}),t.jsx("span",{className:"font-mono",children:s.payment_id})]}),s.collection_id&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"ID de cobro:"}),t.jsx("span",{className:"font-mono",children:s.collection_id})]}),s.external_reference&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Referencia:"}),t.jsx("span",{className:"font-mono",children:s.external_reference})]}),s.payment_type&&t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Método:"}),t.jsx("span",{className:"capitalize",children:s.payment_type.replace("_"," ")})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(y,{onClick:()=>r(c.actionPath),className:"w-full",variant:a==="approved"?"primary":"outline",children:c.actionText}),a==="rejected"&&t.jsx(y,{onClick:()=>r("/servicios"),variant:"outline",className:"w-full",children:"Explorar servicios"}),t.jsx("button",{onClick:()=>r("/"),className:"w-full text-gray-600 hover:text-gray-800 text-sm font-medium transition-colors",children:"Ir al inicio"})]}),t.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[t.jsx("p",{className:"text-sm text-gray-600",children:"¿Tienes preguntas sobre tu pago?"}),t.jsxs("div",{className:"mt-2 space-y-1 text-sm",children:[t.jsx("p",{className:"text-primary-600 font-medium",children:"WhatsApp: +57 300 123 4567"}),t.jsx("p",{className:"text-primary-600 font-medium",children:"Email: soporte@wildtour.co"})]})]})]})})}export{B as default};
