import{r as c,j as e}from"./index-BxPqZtyK.js";/* empty css                         */function E(){var y,N,v,w;const o=useQueryClient(),[u,k]=c.useState("flagged"),[g,M]=c.useState("newest"),[l,x]=c.useState(null),[d,m]=c.useState(""),[b,f]=c.useState(""),{data:t,isLoading:R}=useQuery({queryKey:["moderation-reviews",u,g],queryFn:()=>AdminRepo.getReviewsForModeration({filter:u,sortBy:g})}),{data:r}=useQuery({queryKey:["moderation-stats"],queryFn:()=>AdminRepo.getModerationStats()}),p=useMutation({mutationFn:({reviewId:s,action:a,reason:n})=>AdminRepo.moderateReview(s,a,n),onSuccess:()=>{o.invalidateQueries({queryKey:["moderation-reviews"]}),o.invalidateQueries({queryKey:["moderation-stats"]}),x(null),m(""),f(""),alert("Acción de moderación aplicada exitosamente")},onError:()=>{alert("Error al aplicar la moderación")}}),C=useMutation({mutationFn:({reviewIds:s,action:a,reason:n})=>AdminRepo.bulkModerateReviews(s,a,n),onSuccess:()=>{o.invalidateQueries({queryKey:["moderation-reviews"]}),o.invalidateQueries({queryKey:["moderation-stats"]}),alert("Moderación masiva aplicada exitosamente")}}),[i,h]=c.useState([]),L=s=>{h(a=>a.includes(s)?a.filter(n=>n!==s):[...a,s])},A=()=>{var s,a;i.length===((s=t==null?void 0:t.items)==null?void 0:s.length)?h([]):h(((a=t==null?void 0:t.items)==null?void 0:a.map(n=>n.id))||[])},S=()=>{!l||!d||p.mutate({reviewId:l.id,action:d,reason:b})},j=s=>{if(i.length===0){alert("Selecciona al menos una opinión");return}const a=prompt("Razón para la moderación (opcional):");C.mutate({reviewIds:i,action:s,reason:a||void 0}),h([])},z=(s,a)=>{switch(s){case"published":return e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${a>0?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:a>0?`Publicado (${a} reportes)`:"Publicado"});case"flagged":return e.jsxs("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800",children:["Reportado (",a,")"]});case"hidden":return e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800",children:"Oculto"});case"deleted":return e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-black text-white",children:"Eliminado"});default:return null}},B=s=>({spam:"Spam",offensive:"Contenido ofensivo",inappropriate:"Contenido inapropiado",fake:"Opinión falsa",other:"Otro"})[s]||s;return R?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600"})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Moderación de Opiniones"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona y modera las opiniones de usuarios"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendientes"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:(r==null?void 0:r.pending)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Reportadas"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:(r==null?void 0:r.flagged)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"})})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ocultas"}),e.jsx("p",{className:"text-3xl font-bold text-gray-600",children:(r==null?void 0:r.hidden)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Aprobadas (Hoy)"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:(r==null?void 0:r.approvedToday)||0})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Filtrar:"}),e.jsxs("select",{value:u,onChange:s=>k(s.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"flagged",children:"Reportadas"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"hidden",children:"Ocultas"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ordenar:"}),e.jsxs("select",{value:g,onChange:s=>M(s.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"newest",children:"Más recientes"}),e.jsx("option",{value:"oldest",children:"Más antiguos"}),e.jsx("option",{value:"most_flagged",children:"Más reportados"})]})]})]}),i.length>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[i.length," seleccionadas"]}),e.jsx("button",{onClick:()=>j("approve"),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Aprobar"}),e.jsx("button",{onClick:()=>j("hide"),className:"px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700",children:"Ocultar"}),e.jsx("button",{onClick:()=>j("delete"),className:"px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700",children:"Eliminar"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"checkbox",checked:i.length===((y=t==null?void 0:t.items)==null?void 0:y.length)&&((N=t==null?void 0:t.items)==null?void 0:N.length)>0,onChange:A,className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Seleccionar todas (",((v=t==null?void 0:t.items)==null?void 0:v.length)||0,")"]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:(w=t==null?void 0:t.items)==null?void 0:w.map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("input",{type:"checkbox",checked:i.includes(s.id),onChange:()=>L(s.id),className:"mt-1 rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("img",{src:s.userPhoto||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.userName)}&size=40`,alt:s.userName,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.userName}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.destinationName," • ",new Date(s.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(a=>e.jsx("svg",{className:`w-4 h-4 ${a<=s.rating?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},a))}),z(s.status,s.flags.length)]})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:s.comment}),s.images&&s.images.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:s.images.map((a,n)=>e.jsx("img",{src:a,alt:`Review image ${n+1}`,className:"w-full h-16 object-cover rounded"},n))}),s.flags.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("h5",{className:"font-medium text-red-800 mb-2",children:["Reportes (",s.flags.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.flags.map(a=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-red-700",children:B(a.reason)}),a.description&&e.jsxs("span",{className:"text-red-600",children:[" - ",a.description]}),e.jsxs("span",{className:"text-red-500 ml-2",children:["(",new Date(a.reportedAt).toLocaleDateString(),")"]})]},a.id))})]}),s.moderationHistory.length>0&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"Historial de moderación"}),e.jsx("div",{className:"space-y-1",children:s.moderationHistory.slice(0,3).map((a,n)=>e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:a.action}),a.reason&&e.jsxs("span",{children:[" - ",a.reason]}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["por ",a.moderator," (",new Date(a.timestamp).toLocaleDateString(),")"]})]},n))})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>x(s),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Moderar"}),e.jsx("button",{className:"text-gray-600 hover:text-gray-700 text-sm",children:"Ver historial completo"})]})]})]})},s.id))}),(!(t!=null&&t.items)||t.items.length===0)&&e.jsx("div",{className:"p-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No hay opiniones para moderar con los filtros seleccionados."})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Moderar Opinión"}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("img",{src:l.userPhoto||`https://ui-avatars.com/api/?name=${encodeURIComponent(l.userName)}&size=32`,alt:l.userName,className:"w-8 h-8 rounded-full mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:l.userName}),e.jsx("p",{className:"text-sm text-gray-500",children:l.destinationName})]})]}),e.jsx("div",{className:"flex mb-2",children:[1,2,3,4,5].map(s=>e.jsx("svg",{className:`w-4 h-4 ${s<=l.rating?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},s))}),e.jsx("p",{className:"text-gray-700",children:l.comment})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Acción"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"action",value:"approve",checked:d==="approve",onChange:s=>m(s.target.value),className:"rounded border-gray-300 text-green-600 focus:ring-green-500"}),e.jsx("span",{className:"ml-2 text-green-700",children:"Aprobar - La opinión es válida y apropiada"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"action",value:"hide",checked:d==="hide",onChange:s=>m(s.target.value),className:"rounded border-gray-300 text-yellow-600 focus:ring-yellow-500"}),e.jsx("span",{className:"ml-2 text-yellow-700",children:"Ocultar - Ocultar temporalmente de la vista pública"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"action",value:"delete",checked:d==="delete",onChange:s=>m(s.target.value),className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"ml-2 text-red-700",children:"Eliminar - Eliminar permanentemente por violación"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Razón (opcional)"}),e.jsx("textarea",{value:b,onChange:s=>f(s.target.value),rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500",placeholder:"Explica la razón de tu decisión..."})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>x(null),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{onClick:S,disabled:!d||p.isPending,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:p.isPending?"Aplicando...":"Aplicar moderación"})]})]})]})})})]})}export{E as default};
